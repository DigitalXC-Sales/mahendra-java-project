trigger:
  branches:
    include:
    - master

resources:
  repositories:
  - repository: mygithubrepo
    type: github
    name: DigitalXC-Sales/mahendra-java-project
    endpoint: DigitalXC-Sales

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: Build
  displayName: 'Build Java Web App'
  jobs:
  - job: BuildJob
    steps:
    - checkout: mygithubrepo

    - task: Maven@4
      inputs:
        mavenPomFile: 'pom.xml'
        goals: 'clean package'
        javaHomeOption: 'JDKVersion'
        jdkVersionOption: '1.11'
        mavenVersionOption: 'Default'

    - task: CmdLine@2
      displayName: 'List Target Directory'
      inputs:
        script: |
          echo "Checking target folder contents:"
          ls -lR $(System.DefaultWorkingDirectory)/target

    - task: CopyFiles@2
      inputs:
        contents: '**/target/*.war'
        targetFolder: '$(Build.ArtifactStagingDirectory)'

    - task: PublishBuildArtifacts@1
      inputs:
        pathToPublish: '$(Build.ArtifactStagingDirectory)'
        artifactName: 'java-app'
        publishLocation: 'Container'
